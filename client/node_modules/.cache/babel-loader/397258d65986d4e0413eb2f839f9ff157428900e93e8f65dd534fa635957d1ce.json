{"ast":null,"code":"var _jsxFileName = \"/Users/kyuhyunpark/Desktop/HotelByKaaPaaa/HotelKP/client/src/components/hotel/HotelReservation.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function HotelReservation() {\n  _s();\n  const loggedInUser = JSON.parse(localStorage.getItem(\"loggedInUser\"));\n  const userId = loggedInUser.id;\n  const userRole = loggedInUser.userRole;\n  const token = sessionStorage.getItem(\"accessToken\");\n  const [reservationData, setReservationData] = useState([]);\n  useEffect(() => {\n    async function fetchReservation() {\n      try {\n        let res;\n        if (userRole === 'hotel_admin') {\n          res = await axios.get(`/api/adminPayment/${userId}`, {\n            headers: {\n              Authorization: `Bearer ${token}`\n            }\n          });\n        } else {\n          res = await axios.get(`/api/userPayment/${userId}`, {\n            headers: {\n              Authorization: `Bearer ${token}`\n            }\n          });\n        }\n        console.log('fetchReservation', res);\n        setReservationData(res.data.result);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n    fetchReservation();\n  }, [userId]);\n  const handleConfirm = async payment_id => {\n    try {\n      await axios.patch(`/api/hotelPayments/${payment_id}`, {\n        status: '예약 확정'\n      }, {\n        headers: {\n          Authorization: `Barer ${token}`\n        }\n      });\n      const updatedReservation = reservationData.find(data => data.payment_id === payment_id);\n      await axios.post(\"/api/notification\", {\n        title: \"예약 확정 되었습니다\",\n        body: `호텔:${updatedReservation.hotel_name},체크인: ${updatedReservation.check_in}`,\n        user_id: updatedReservation.payment_user_id\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setReservationData(prev => prev.map(data => data.payment_id === payment_id ? {\n        ...data,\n        status: '예약 확정'\n      } : data));\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"\\uACB0\\uC81C \\uB0B4\\uC5ED\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }, this), reservationData && reservationData.map(data => /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"\\uC608\\uC57D \\uC0C1\\uD0DC : \", data.status, \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 47\n      }, this), \"\\uD638\\uD154 \\uC774\\uB984 :\", data.hotel_name, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 49\n      }, this), \"\\uD638\\uC2A4\\uD2B8 : \", data.hotel_owner_id, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 52\n      }, this), \"\\uC608\\uC57D\\uC778 : \", data.payment_user_id, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 53\n      }, this), \"\\uB0A0\\uC9DC : \", data.check_in, \"-\", data.check_out, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 62\n      }, this), \"\\uACB0\\uC81C\\uAE08\\uC561 : \", data.price, \"\\uC6D0\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 45\n      }, this), userRole === 'hotel_admin' && data.status !== \"예약 확정\" && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => handleConfirm(data.payment_id),\n        children: \"\\uC608\\uC57D \\uC218\\uB77D\\uD558\\uAE30\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 25\n      }, this), \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 96\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 101\n      }, this)]\n    }, data.payment_id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 21\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 9\n  }, this);\n}\n_s(HotelReservation, \"2fnXN8fj8rRJVpY1sWLRRu5akLU=\");\n_c = HotelReservation;\nvar _c;\n$RefreshReg$(_c, \"HotelReservation\");","map":{"version":3,"names":["React","useState","useEffect","axios","jsxDEV","_jsxDEV","HotelReservation","_s","loggedInUser","JSON","parse","localStorage","getItem","userId","id","userRole","token","sessionStorage","reservationData","setReservationData","fetchReservation","res","get","headers","Authorization","console","log","data","result","error","handleConfirm","payment_id","patch","status","updatedReservation","find","post","title","body","hotel_name","check_in","user_id","payment_user_id","prev","map","children","fileName","_jsxFileName","lineNumber","columnNumber","hotel_owner_id","check_out","price","onClick","_c","$RefreshReg$"],"sources":["/Users/kyuhyunpark/Desktop/HotelByKaaPaaa/HotelKP/client/src/components/hotel/HotelReservation.jsx"],"sourcesContent":["import React, {useState, useEffect} from 'react';\nimport axios from \"axios\";\n\nexport default function HotelReservation() {\n    const loggedInUser = JSON.parse(localStorage.getItem(\"loggedInUser\"));\n    const userId = loggedInUser.id;\n    const userRole = loggedInUser.userRole;\n    const token = sessionStorage.getItem(\"accessToken\")  \n\n    const [reservationData, setReservationData] = useState([]);\n\n    useEffect(() => {\n        async function fetchReservation() {\n            try{\n                let res;\n                if (userRole === 'hotel_admin') {\n                    res = await axios.get(`/api/adminPayment/${userId}`, {\n                        headers: { Authorization: `Bearer ${token}` },\n                    });\n                } else {\n                    res = await axios.get(`/api/userPayment/${userId}`, {\n                        headers: { Authorization: `Bearer ${token}` },\n                    });\n                }\n                console.log('fetchReservation', res);\n                setReservationData(res.data.result)\n            } catch(error){\n                console.log(error);\n            }\n        }\n        fetchReservation();\n    }, [userId])\n\n    const handleConfirm = async(payment_id) => {\n        try {\n            await axios.patch(`/api/hotelPayments/${payment_id}`,\n            {\n                status:'예약 확정',\n            }, {\n                headers:{Authorization:`Barer ${token}`},\n            })\n            const updatedReservation = reservationData.find(data => data.payment_id === payment_id);\n\n            await axios.post(\"/api/notification\", \n            {\n               title: \"예약 확정 되었습니다\",\n               body: `호텔:${updatedReservation.hotel_name},체크인: ${updatedReservation.check_in}`,\n                      user_id: updatedReservation.payment_user_id\n            },{\n               headers:{Authorization:`Bearer ${token}`}\n            });\n        \n            setReservationData(prev => \n                prev.map(data =>\n                    data.payment_id === payment_id ? {...data, status:'예약 확정'} : data)\n                )\n        } catch (error) {\n            console.log(error);\n        }\n    };\n\n    return (\n        <section>\n            <h1>결제 내역</h1>\n            {\n                reservationData && reservationData.map((data)=>(\n                    \n                    <div key={data.payment_id}>\n                        예약 상태 : {data.status} <br/>\n                        호텔 이름 :{data.hotel_name}<br/>\n                        호스트 : {data.hotel_owner_id}<br/>\n                        예약인 : {data.payment_user_id}<br/>\n                        날짜 : {data.check_in}-{data.check_out}<br/>\n                        결제금액 : {data.price}원<br/>\n\n                        {userRole === 'hotel_admin' && data.status !== \"예약 확정\" &&\n                        <button onClick={()=>handleConfirm(data.payment_id)}>예약 수락하기</button>} <br/><br/>\n                    </div>\n                ))\n            }\n        </section>\n    );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}